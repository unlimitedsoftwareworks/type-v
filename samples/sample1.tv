VERSION: 1

CONST:

GLOBAL:
    x: u64 = 0
CODE:
    p_queue_size r0
    debug_reg r0

    ; spawn
    p_alloc r1 proc1
    mv_reg_i r15 10
    promise_alloc r2
    p_emit r1 r2
    promise_await r2
    p_send_sig r1 1
    halt


proc1:
    p_wait_queue
    p_dequeue r14
    mv_reg_i r15 0
    add_u32 r1 r1 r1
    add_u32 r1 r1 r1
    add_u32 r1 r1 r1
    add_u32 r1 r1 r1
    add_u32 r1 r1 r1

    promise_resolve r14 r15
    debug_reg r14
    j proc1

